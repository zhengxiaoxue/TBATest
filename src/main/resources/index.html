<!DOCTYPE html>
<html>
<head> 
  <meta charset="utf-8">
   
  <title>Monitor</title> 
</head>
<body>
<div style="text-align: center;">
<textarea rows="20" cols="30" disabled="disabled"
          style="resize:none;border-style:none;width:750px;height:120px">
Instruction: There is only one track has 20 positions,you can instantiate cranes at any position.
  * For instantiation and moving out we can directly operate cranes, no need to move other cranes.
  * For moving we suppose all cranes are same so we operate the crane to the left or the right in horizontal level.
  * Example: we use craneId:position1 represents crane with craneId is at positon1
    1:1,2:2 after move 1 to position 3 it becomes 1:2,2:3, move right
    1:2,2:6 after move 2 to position 1 it becomes 1:1,2:2, move left
</textarea>
</div>
<div style="text-align: center;">
  <form action="" method="POST" style="margin-left: -70px">
    Instantiate Cranes:
    <input type="text" id="crane_positions" style="width:260px" placeholder="exp: 1:1,2:2">
    <input type="submit" value="Submit" onclick="instantiateCrane()">
  </form>
  <p></p>
  <form action="" style="margin-left: -165px">
    Move&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Crane:
    <input type="text" id="move_crane_id" style="width: 70px" placeholder="crane id">
    <input type="text" id="new_position" style="width: 80px" placeholder="new position">
    <input type="submit" value="Submit" onclick="moveCrane()">
  </form>
  <p></p>
  <form action="" style="margin-left: -260px">
    Move &nbsp;Out &nbsp;Crane: <input type="text" id="move_out_crane_id" style="width: 70px" placeholder="crane id">

    <input type="submit" value="Submit" onclick="moveOutCrane()">
  </form>
</div>
<hr/>
<div style="text-align: center;">
  <p></p>
  Yard
  <p></p>

  <textarea id="paring_location_1" rows="5" cols="2" disabled="disabled"
            style="resize:none;border-style:none;background-color:grey;
				 text-aline:centre;justify-content:center;font-weight:bold">
		Park
	</textarea>
  <textarea id="position_1" rows="5" cols="2" disabled="disabled"
            style="resize:none;border-style:none;background-color:darkgrey;">
	</textarea>
  <textarea id="position_2" rows="5" cols="2" disabled="disabled"
            style="resize:none;border-style:none;background-color:darkgrey;">
	</textarea>
  <textarea id="position_3" rows="5" cols="2" disabled="disabled"
            style="resize:none;border-style:none;background-color:darkgrey;">
	</textarea>

  <textarea id="position_4" rows="5" cols="2" disabled="disabled"
            style="resize:none;border-style:none;background-color:darkgrey;">
	</textarea>
  <textarea id="position_5" rows="5" cols="2" disabled="disabled"
            style="resize:none;border-style:none;background-color:darkgrey;">
	</textarea>
  <textarea id="position_6" rows="5" cols="2" disabled="disabled"
            style="resize:none;border-style:none;background-color:darkgrey;">
	</textarea>
  <textarea id="position_7" rows="5" cols="2" disabled="disabled"
            style="resize:none;border-style:none;background-color:darkgrey;">
	</textarea>
  <textarea id="position_8" rows="5" cols="2" disabled="disabled"
            style="resize:none;border-style:none;background-color:darkgrey;">
	</textarea>
  <textarea id="position_9" rows="5" cols="2" disabled="disabled"
            style="resize:none;border-style:none;background-color:darkgrey;">
	</textarea>
  <textarea id="position_10" rows="5" cols="2" disabled="disabled"
            style="resize:none;border-style:none;background-color:darkgrey;">
	</textarea>
  <textarea id="position_11" rows="5" cols="2" disabled="disabled"
            style="resize:none;border-style:none;background-color:darkgrey;">
	</textarea>
  <textarea id="position_12" rows="5" cols="2" disabled="disabled"
            style="resize:none;border-style:none;background-color:darkgrey;">
	</textarea>
  <textarea id="position_13" rows="5" cols="2" disabled="disabled"
            style="resize:none;border-style:none;background-color:darkgrey;">
	</textarea>
  <textarea id="position_14" rows="5" cols="2" disabled="disabled"
            style="resize:none;border-style:none;background-color:darkgrey;">
	</textarea>
  <textarea id="position_15" rows="5" cols="2" disabled="disabled"
            style="resize:none;border-style:none;background-color:darkgrey;">
	</textarea>
  <textarea id="position_16" rows="5" cols="2" disabled="disabled"
            style="resize:none;border-style:none;background-color:darkgrey;">
	</textarea>
  <textarea id="position_17" rows="5" cols="2" disabled="disabled"
            style="resize:none;border-style:none;background-color:darkgrey;">
	</textarea>
  <textarea id="position_18" rows="5" cols="2" disabled="disabled"
            style="resize:none;border-style:none;background-color:darkgrey;">
	</textarea>
  <textarea id="position_19" rows="5" cols="2" disabled="disabled"
            style="resize:none;border-style:none;background-color:darkgrey;">
	</textarea>
  <textarea id="position_20" rows="5" cols="2" disabled="disabled"
            style="resize:none;border-style:none;background-color:grey;font-weight:bold">
		Park
	</textarea>
</div>
<script type="text/javascript" src="jquery-3.5.1.min.js"></script>
<script>
		function instantiateCrane() {
        var request = {
          "cranes":document.getElementById("crane_positions").value
        }
		    $.ajax({
		        type: "POST",
		        contentType: "application/json;charset=utf-8",
		        url: "http://localhost:8081/crane/set",
		        data: JSON.stringify(request),
		        success: function (result) {
		            console.log(result);
		        },
		        error : function(e) {
		        	alert(e.responseText)
		        }
		    });
		}
		function moveCrane() {
			var request = {
				"craneId":document.getElementById("move_crane_id").value,
				"newPosition":document.getElementById("new_position").value
			}
		    $.ajax({
		        type: "POST",
		        contentType: "application/json;charset=utf-8",
		        url: "http://localhost:8081/crane/move",
		        data: JSON.stringify(request),
		        success: function (result) {

		        },
		        error : function(e) {
		            alert(e.responseText);
		        }
		    });
		}
		function moveOutCrane() {
			var request = {
				"craneId":document.getElementById("move_out_crane_id").value
			}
		    $.ajax({
		        type: "POST",
		        contentType: "application/json;charset=utf-8",
		        url: "http://localhost:8081/crane/moveout",
		        data: JSON.stringify(request),
		        success: function (result) {
		            console.log(result);

		        },
		        error : function(e) {
		            alert(e.responseText);
		        }
		    });
		}



</script>
<script type="text/javascript">
            if ("WebSocket" in window)
            {
               var ws = new WebSocket("ws://localhost:8082/monitor");

               ws.onopen = function()
               {
               };

               ws.onmessage = function (evt)
               {
                  var received_msg = evt.data;
									var arr = received_msg.split(":");
									var crane_id = arr[0]
									var x = arr[1]
									var y = arr[2];

									for(i=1; i<=20; i++){
											if(document.getElementById("position_"+i).innerHTML == crane_id){
													document.getElementById("position_"+i).innerHTML = "";
													document.getElementById("position_"+i).style.backgroundColor  = "darkgrey";
													break;
											}
									}
									if(y != "-1"){
											document.getElementById("position_"+y).innerHTML = crane_id
									    document.getElementById("position_"+y).style.backgroundColor  = "blue"
									}

               };

               ws.onclose = function()
               {
               };
            }

            else
            {
               alert("Your browser doesn't support webSocket! You may miss important notice");
            }



</script>
<script type="text/javascript">
	$.ajax({
		        type: "GET",
		        contentType: "application/json;charset=utf-8",
		        url: "http://localhost:8081/crane/reload",
		        success: function (response) {
		            var obj = JSON.parse(response);
		            console.log(obj);
		            var result = obj.message;
		            if(result.length==0) return
		            var p = result.split(",");
		            for(i=0; i<p.length; i++){
		              if(p){
		                var arr = p[i].split(":");
		                var y = arr[2]
                    document.getElementById("position_"+y).innerHTML = arr[0]
                    document.getElementById("position_"+y).style.backgroundColor  = "blue"
		              }
		            }
		        },
		        error : function(e) {
		            alert(e.responseText);
		        }
		    });
</script>
</body>
</html>
